<!doctype html><html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Khosha Team Chat</title><style>
:root{--bg:#0f172a;--panel:#111827;--line:#334155;--text:#e5e7eb;--muted:#94a3b8;--pri:#3b82f6}
*{box-sizing:border-box}body{margin:0;font-family:Inter,system-ui;background:var(--bg);color:var(--text)}
.wrap{max-width:1000px;margin:0 auto;padding:16px}.grid{display:grid;grid-template-columns:280px 1fr;gap:12px}
.card{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:12px}.agent{padding:10px;border:1px solid var(--line);border-radius:10px;margin:8px 0;cursor:pointer}.agent.active{border-color:var(--pri);background:#0b1d3f}
#chat{height:60vh;overflow:auto;display:flex;flex-direction:column;gap:8px}.b{padding:10px;border-radius:10px;max-width:80%}.me{align-self:flex-end;background:#1d4ed8}.ai{align-self:flex-start;background:#1f2937}
.row{display:flex;gap:8px;margin-top:8px}textarea{flex:1;min-height:70px;background:#0b1220;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px}button{background:var(--pri);color:#fff;border:none;border-radius:10px;padding:10px 14px;cursor:pointer}
.small{font-size:12px;color:var(--muted)}@media(max-width:820px){.grid{grid-template-columns:1fr}}
</style></head><body><div class="wrap"><h1>Khosha Team Chat</h1><p class="small">Talk directly with Keith and all live sub-agents.</p><div class="grid"><aside class="card"><h3>Agents</h3><div id="agents"></div></aside><section class="card"><h3 id="title">Select an agent</h3><div id="chat"></div><div class="row"><textarea id="msg" placeholder="Type your message..."></textarea><button id="send">Send</button></div></section></div></div><script>
const state={agent:null,name:null,history:{}};
const agentsEl=document.getElementById('agents'), chat=document.getElementById('chat'), title=document.getElementById('title');
function drawAgents(list){agentsEl.innerHTML=list.map(a=>`<div class='agent ${state.agent===a.key?'active':''}' data-k='${a.key}' data-n='${a.name}'>${a.name}</div>`).join('');document.querySelectorAll('.agent').forEach(el=>el.onclick=()=>{state.agent=el.dataset.k;state.name=el.dataset.n;state.history[state.agent]=state.history[state.agent]||[];title.textContent=state.name;drawAgents(list);drawChat();});}
function drawChat(){const h=state.history[state.agent]||[];chat.innerHTML=h.map(x=>`<div class='b ${x.role}'>${x.text.replace(/</g,'&lt;')}</div>`).join('');chat.scrollTop=chat.scrollHeight;}
async function init(){const r=await fetch('/api/teamchat/agents');const j=await r.json();drawAgents(j.agents||[]);} init();
document.getElementById('send').onclick=async()=>{if(!state.agent) return alert('Select an agent');const t=document.getElementById('msg').value.trim();if(!t)return;state.history[state.agent].push({role:'me',text:t});drawChat();document.getElementById('msg').value='';const r=await fetch('/api/teamchat/send',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({agent:state.agent,message:t})});const j=await r.json();state.history[state.agent].push({role:'ai',text:j.reply||j.error||'No response'});drawChat();};
</script></body></html>
